/**********************************************************************************
**
**		file: jquery.tristate.js
**		version: 1.0
**		author: Ben Belcourt
**		creation date: 09.17.2009
**		dependencies: "jquery-1.3.2.js" or higher
**
**		This file contains the functionality for implementing 3 state checkboxes.
**
**********************************************************************************/

(function(e){e.fn.tristate=function(j){var c=e.extend({checkedClass:"checked",fullClass:"full",heading:"span.label",partialClass:"partial",showOriginalInputs:false},j);return this.each(function(){obj=e(this);var f={init:function(){e(c.heading,obj).before('<a href="#" class="checkbox">Heading</a>');for(var a=e('input[type="checkbox"]',obj),b=0,d=a.length;b<d;b++)f.hideInput(e(a[b]));f.updateProxyStates();e("a.checkbox",obj).click(function(g){g.preventDefault();f.initProxyClick(e(this))})},checkSiblings:function(a, b){var d=a.parent("li").siblings().children("a.checkbox"),g=0;a=a.parent("li").parent("ul");var i=e("ul",a),h;b&&g++;for(b=0;b<d.length;b++)if(e(d[b]).hasClass(c.checkedClass)||e(d[b]).hasClass(c.partialClass))g++;g<d.length+1?(h=c.partialClass):(h=c.fullClass);for(d=0;d<i.length;d++)if(e(i[d]).hasClass(c.partialClass))h=c.partialClass;if(g===0)h="";a.removeClass(c.partialClass+" "+c.fullClass).addClass(h)},initProxyClick:function(a){var b;f.setInputField(a);e(a).hasClass(c.checkedClass)===true|| e(a).hasClass(c.partialClass)===true?(b=true):(b=false);f.checkSiblings(a,b);f.setDescendants(a,b);f.setAncestors(a,b);f.updateProxyStates()},updateProxyStates:function(){for(var a=e("input:checked",obj),b,d=0,g=a.length;d<g;d++){b=e(a[d]).siblings("a.checkbox");f.setInputField(e(b),"checked");f.checkSiblings(e(a[d]),true);f.setAncestors(e(a[d]),true)}},hideInput:function(a){var b=a.attr("name"),d=e('<a href="#" class="checkbox">'+b+"</a>");d.data("name",b);a.before(d);c.showOriginalInputs||a.hide()}, setAncestors:function(a){var b;b=a.parent("li").parent("ul");a=b.parent("li").children("a.checkbox");if(!b.hasClass(c.partialClass)&&!b.hasClass(c.fullClass)){a.removeClass(c.checkedClass+" "+c.partialClass);f.setInputField(a,"unchecked");b=false}else{f.setInputField(a,"checked");b.hasClass(c.partialClass)&&a.removeClass(c.checkedClass).addClass(c.partialClass);b.hasClass(c.fullClass)&&a.removeClass(c.partialClass).addClass(c.checkedClass);b=true}if(a.length>0){f.checkSiblings(a,b);f.setAncestors(a, a.hasClass(c.checkedClass))}},setDescendants:function(a,b){var d=a.parent("li");a=e("ul",d);d=e("a.checkbox",d);if(b){b=0;for(var g=d.length;b<g;b++)f.setInputField(e(d[b]),"checked");a.removeClass(c.partialClass+" "+c.fullClass).addClass(c.fullClass)}else{b=0;for(g=d.length;b<g;b++)f.setInputField(e(d[b]),"unchecked");a.removeClass(c.partialClass+" "+c.fullClass)}},setInputField:function(a,b){switch(b||""){case "":a.hasClass(c.checkedClass)===true?f.uncheckInput(a):f.checkInput(a);break;case "checked":f.checkInput(a); break;case "unchecked":f.uncheckInput(a);break}},checkInput:function(a){a.removeClass(c.partialClass).addClass(c.checkedClass).siblings('input[name="'+a.data("name")+'"]').attr("checked","checked")},uncheckInput:function(a){a.removeClass(c.checkedClass+" "+c.partialClass).siblings('input[name="'+a.data("name")+'"]').attr("checked","")}};f.init()})}})(jQuery);
