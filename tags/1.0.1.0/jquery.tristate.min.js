/**********************************************************************************
**
**		file: jquery.tristate.js
**		version: 1.0
**		author: Ben Belcourt
**		creation date: 09.17.2009
**		dependencies: "jquery-1.3.2.js" or higher
**
**		This file contains the functionality for implementing 3 state checkboxes.
**
**********************************************************************************/

(function(f){f.fn.tristate=function(l){var b=f.extend({checkedClass:"checked",fullClass:"full",heading:"span.label",partialClass:"partial",showOriginalInputs:false},l);return this.each(function(){obj=f(this);var e={init:function(){obj.find(b.heading).before('<a href="#" class="checkbox">Heading</a>').wrap("<label></label>");for(var a=obj.find('input[type="checkbox"]'),c=0,d=a.length;c<d;c++)e.hideInput(f(a[c]));e.updateProxyStates();obj.find("a.checkbox, label").bind("click",function(g){g.preventDefault();e.initProxyClick(f(this))})},checkSiblings:function(a,c){var d=a.parent("li").siblings().children("a.checkbox"),g=0,h=a.parent("li").parent("ul"),i=h.find("ul"),j;c&&g++;for(var k=0;k<d.length;k++)if(f(d[k]).hasClass(b.checkedClass)||f(d[k]).hasClass(b.partialClass))g++;g<d.length+1?(j=b.partialClass):(j=b.fullClass);for(d=0;d<i.length;d++)if(f(i[d]).hasClass(b.partialClass))j=b.partialClass;if(g===0)j="";h.removeClass(b.partialClass+" "+b.fullClass).addClass(j)},initProxyClick:function(a){var c;e.setInputField(a);f(a).hasClass(b.checkedClass)===true||f(a).hasClass(b.partialClass)===true?(c=true):(c=false);e.checkSiblings(a,c);e.setDescendants(a,c);e.setAncestors(a,c);e.updateProxyStates()},updateProxyStates:function(){for(var a=f("input:checked",obj),c,d=0,g=a.length;d<g;d++){c=f(a[d]).siblings("a.checkbox");e.setInputField(f(c),"checked");e.checkSiblings(f(a[d]),true);e.setAncestors(f(a[d]),true)}},hideInput:function(a){var c=a.attr("name"),d=f('<a href="#" class="checkbox">'+c+"</a>");d.data("name",c);a.before(d);b.showOriginalInputs||a.hide()},setAncestors:function(a){var c;c=a.parent("li").parent("ul");a=c.parent("li").children("a.checkbox");if(!c.hasClass(b.partialClass)&&!c.hasClass(b.fullClass)){a.removeClass(b.checkedClass+" "+b.partialClass);e.setInputField(a,"unchecked");c=false}else{e.setInputField(a,"checked");c.hasClass(b.partialClass)&&a.removeClass(b.checkedClass).addClass(b.partialClass);c.hasClass(b.fullClass)&&a.removeClass(b.partialClass).addClass(b.checkedClass);c=true}if(a.length>0){e.checkSiblings(a,c);e.setAncestors(a,a.hasClass(b.checkedClass))}},setDescendants:function(a,c){var d=a.parent("li"),g=d.find("ul");d=d.find("a.checkbox");if(c){for(var h=0,i=d.length;h<i;h++)e.setInputField(f(d[h]),"checked");g.removeClass(b.partialClass+" "+b.fullClass).addClass(b.fullClass)}else{h=0;for(i=d.length;h<i;h++)e.setInputField(f(d[h]),"unchecked");g.removeClass(b.partialClass+" "+b.fullClass)}},setInputField:function(a,c){switch(c||""){case "":a.hasClass(b.checkedClass)===true?e.uncheckInput(a):e.checkInput(a);break;case "checked":e.checkInput(a);break;case "unchecked":e.uncheckInput(a);break}},checkInput:function(a){a.removeClass(b.partialClass).addClass(b.checkedClass).siblings('input[name="'+a.data("name")+'"]').attr("checked","checked")},uncheckInput:function(a){a.removeClass(b.checkedClass+" "+b.partialClass).siblings('input[name="'+a.data("name")+'"]').attr("checked","")}};e.init()})}})(jQuery);
